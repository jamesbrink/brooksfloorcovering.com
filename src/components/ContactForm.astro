---
// Contact form component - submits via Formspree
const FORMSPREE_ID = import.meta.env.PUBLIC_FORMSPREE_ID || 'xwpkpbjq';
const formAction = `https://formspree.io/f/${FORMSPREE_ID}`;
---

<div class="bg-neutral-50 p-6 rounded-lg">
  <form class="space-y-4" id="contact-form" action={formAction} method="POST">
    <div>
      <label for="name" class="block text-sm font-medium mb-1">Name *</label>
      <input
        type="text"
        id="name"
        name="name"
        class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"
        required
      />
    </div>
    <div>
      <label for="email" class="block text-sm font-medium mb-1">Email *</label>
      <input
        type="email"
        id="email"
        name="email"
        class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"
        required
      />
    </div>
    <div>
      <label for="phone" class="block text-sm font-medium mb-1">Phone</label>
      <input
        type="tel"
        id="phone"
        name="phone"
        class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"
      />
    </div>
    <div>
      <label for="message" class="block text-sm font-medium mb-1">Message *</label>
      <textarea
        id="message"
        name="message"
        rows="4"
        class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 resize-none"
        required></textarea>
    </div>
    <input type="hidden" name="_subject" value="New contact from brooksfloorcovering.com" />
    <input type="text" name="_gotcha" class="hidden" tabindex="-1" autocomplete="off" />
    <button
      type="submit"
      id="contact-submit"
      class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300"
    >
      Send Message
    </button>
  </form>
  <div id="form-success" class="hidden text-center py-8" role="status" aria-live="polite">
    <div class="text-4xl mb-4" aria-hidden="true">&#10003;</div>
    <h3 class="text-xl font-semibold mb-2">Message Sent!</h3>
    <p class="text-neutral-600">Thank you for contacting us. We'll get back to you shortly.</p>
  </div>
  <div id="form-error" class="hidden text-center py-8" role="alert" aria-live="assertive">
    <p class="text-red-600 font-medium">
      Something went wrong. Please call us at
      <a href="tel:+16236888422" class="underline">(623) 688-8422</a> or email
      <a href="mailto:info@brooksfloorcovering.com" class="underline"
        >info@brooksfloorcovering.com</a
      >.
    </p>
  </div>
</div>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const successDiv = document.getElementById('form-success')!;
  const errorDiv = document.getElementById('form-error')!;
  const submitBtn = document.getElementById('contact-submit') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    successDiv.classList.add('hidden');
    errorDiv.classList.add('hidden');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    try {
      const response = await fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        headers: { Accept: 'application/json' },
      });

      if (response.ok) {
        form.classList.add('hidden');
        successDiv.classList.remove('hidden');
      } else {
        errorDiv.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
      }
    } catch {
      errorDiv.classList.remove('hidden');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send Message';
    }
  });
</script>
